
## Email from Slava

    Vyacheslav E. Krutelyov via fermicloud.onmicrosoft.com 
    3:16 PM (36 minutes ago)
    Reply
    to Balaji, Philip
    Hi Philip
    I'm adding Balaji in cc
    The latest version of the code is in
    https://github.com/slava77/cms-tkph2-ntuple/tree/superDoubletLinked-91X-noMock
    It needs input ntuples.
    The files are in
    /hadoop/cms/store/user/slava77/CMSSW_9_1_0_pre1-tkNtuple/2023PU200/
    20634.0_TTbar_*/trackingNtuple.root has the flat tracker layout
    21434.0_TTbar_*/trackingNtuple.root has the tilted tracker layout
    The plots in the slides were based on an older 62XSLHC release
    with the older flat tracker layout which was the default.
    I validated that results are about the same with the new release.
    So, perhaps we do not need to start from the earlier version for
    reproducibility purposes.
    The driver script is
    runSuperDoublets.sh
    it currently has the input ntuple set to the flat layout.
    The plots equivalent to what's in the slides should come out from
    ./runSuperDoublets.sh -n 30 -mm 3 -DB 16.0 -DE 24.0 -us 1
    The available options are:
    -n : the number of events to run
    -mm : "mock mode" configuration switch
            0-3 reduces the actual CMSSW layout to the simplified geometry layout
                    based on simhit position and momentum info
            0 : straight line trajectory from the anchor to the next layer
            1 : helix line trajectory from the anchor to the next layer
            3: as 1 but offset by rechit position to mimic realistic reco resolution
            11: use simhits from the actual geometry
            13: use actual rechits
            IIRC, mm=13 was not fully working yet
    -DB and -DE: distance between the anchor layer (odd) and the next layer
    -us : use of pixel tracker seed to link ... always 1
            0 : ignores input pixel seeds and doesn't make plots linking them with
    the OT segments
    The driver script calls
    ScanChainMockSuperDoublets function from the doubletAnalysis.C file.
    Almost everything is in one function.
    So, reading it may be a bit hard.
                    --slava

## Getting started

Working directory

    ~/public_html/analysis/tracking/cms-tkph2-ntuple

Setup

    source rooutil/root.sh

Modified the code a little bit

    $ git diff runSuperDoublets.sh
    diff --git a/runSuperDoublets.sh b/runSuperDoublets.sh
    index 8f2fb54d..c1218313 100755
    --- a/runSuperDoublets.sh
    +++ b/runSuperDoublets.sh
    @@ -10,7 +10,14 @@ while [ X$# != X0 ] ; do
         esac
     done
    
    +# echo -e ".L doubletAnalysis.C++ \n\
    +# t9 = new TChain(\"trackingNtuple/tree\"); t9->Add(\"/Data/cms/tkph2/stublink/CMSSW_9_1_0_pre1-tkNtuple/2023PU140/20634.0_TTbar_14TeV+TTbar_14TeV_TuneCUETP8M1_2023D10PU_GenSimHLBeamSpotFull14+DigiFullTriggerPU_2023D10PU+RecoFullGlobalPU_2023D10PU+HARVESTFullGlobalPU_2023D10PU/trackingNtuple.root\"); ScanChainMockSuperDoublets(t9, ${n}, true, ${mm}, ${DB}, ${DE}, ${us}, false, true, true);\n.qqqq"\
    +#     | root -l -b >& a_ttbar_stats_91X_2023PU140_20634.0_mm${mm}_sd${DB}cm${DE}cm_us${us}.log
    +
    +# echo -e ".L doubletAnalysis.C++ \n\
    +# t9 = new TChain(\"trackingNtuple/tree\"); t9->Add(\"/hadoop/cms/store/user/slava77/CMSSW_9_1_0_pre1-tkNtuple/2023PU200/20634.0_TTbar_14TeV+TTbar_14TeV_TuneCUETP8M1_2023D10PU_GenSimHLBeamSpotFull14+DigiFullTriggerPU_2023D10PU+RecoFullGlobalPU_2023D10PU+HARVESTFullGlobalPU_2023D10PU/trackingNtuple.root\"); ScanChainMockSuperDoublets(t9, ${n}, true, ${mm}, ${DB}, ${DE}, ${us}, false, true, true);\n.qqqq"\
    +#     | root -l -b >& a_ttbar_stats_91X_2023PU200_20634.0_mm${mm}_sd${DB}cm${DE}cm_us${us}.log
    +
     echo -e ".L doubletAnalysis.C++ \n\
    -t9 = new TChain(\"trackingNtuple/tree\"); t9->Add(\"/Data/cms/tkph2/stublink/CMSSW_9_1_0_pre1-tkNtuple/2023PU140/20634.0_TTbar_14TeV+TTbar_14TeV_TuneCUETP8M1_2023D10PU_GenSimHLBeamSpotFull14+DigiFullTriggerPU_2023D10PU+RecoFullGlobalPU_2023D10PU+HARVESTFullGlobalPU_2023D10PU/trackingNtuple.root\"); ScanChainMockSuperDoublets(t9, ${n}, true, ${mm}, ${DB}, ${DE}, ${us}, false, true, true);\n.qqqq"\
    +t9 = new TChain(\"trackingNtuple/tree\"); t9->Add(\"/hadoop/cms/store/user/slava77/CMSSW_9_1_0_pre1-tkNtuple/2023PU140/20634.0_TTbar_14TeV+TTbar_14TeV_TuneCUETP8M1_2023D10PU_GenSimHLBeamSpotFull14+DigiFullTriggerPU_2023D10PU+RecoFullGlobalPU_2023D10PU+HARVESTFullGlobalPU_2023D10PU/trackingNtuple.root\"); ScanChainMockSuperDoublets(t9, ${n}, true, ${mm}, ${DB}, ${DE}, ${us}, false, true, true);\n.qqqq"\
         | root -l -b >& a_ttbar_stats_91X_2023PU140_20634.0_mm${mm}_sd${DB}cm${DE}cm_us${us}.log
    -

Then I ran with

    ./runSuperDoublets.sh -n 30 -mm 3 -DB 16.0 -DE 24.0 -us 1

I noticed that the PU200 version of the input would complain about missing branches. So I changed to PU140. Besides the slides were made with PU140 afaik.
Afterwards, code started running just fine.

The code ran for about 10 minutes.

    [02/22 03:51:08 PM] <1044> <jobs:0> [phchang@uaf-10] [~/public_html/analysis/tracking/cms-tkph2-ntuple]
    $ ./runSuperDoublets.sh -n 30 -mm 3 -DB 16.0 -DE 24.0 -us 1
    [02/22 04:00:41 PM] <1045> <jobs:0> [phchang@uaf-10] [~/public_html/analysis/tracking/cms-tkph2-ntuple]
    $

It seemed to have output a lot of .png files (see [here](results/20190222_firstrun))
